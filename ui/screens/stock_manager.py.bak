import customtkinter as ctk
from tkinter import ttk, messagebox
from typing import Optional, Dict, List, Tuple, Callable

class StockManager(ctk.CTkFrame):
    """
    Interface de gestion du stock avec un design moderne en mode sombre, aligné avec le style du dashboard.
    """
    
    # Constantes de style
    COLORS = {
        "light": {
            "text": "#212529",
            "subtext": "#666666",
            "border": "#e0e0e0",
            "chart_bg": "#f8f9fa",
            "activity_bg": "#f8f9fa",
            # Ajout des couleurs spécifiques au gestionnaire de stock
            "bg": "#f8f9fa",
            "primary": "#4361ee",
            "primary_hover": "#3a56d4",
            "secondary": "#6c757d",
            "secondary_hover": "#5a6268",
            "success": "#198754",
            "success_bg": "#d1e7dd",
            "warning": "#ffc107",
            "warning_bg": "#fff3cd",
            "danger": "#dc3545",
            "danger_hover": "#bb2d3b",
            "danger_bg": "#f8d7da",
            "table_header": "#f8f9fa",
            "table_selected": "#e9ecef",
            "placeholder_text": "#6c757d"
        },
        "dark": {
            "text": "#f8f9fa",
            "subtext": "#999999",
            "border": "#333333",
            "chart_bg": "#252525",
            "activity_bg": "#252525",
            # Ajout des couleurs spécifiques au gestionnaire de stock
            "bg": "#1a1a1a",
            "primary": "#4cc9f0",
            "primary_hover": "#3ab5d9",
            "secondary": "#6c757d",
            "secondary_hover": "#5a6268",
            "success": "#20c997",
            "success_bg": "#0a3622",
            "warning": "#ffc107",
            "warning_bg": "#664d03",
            "danger": "#f72585",
            "danger_hover": "#d61f74",
            "danger_bg": "4a0e29",
            "table_header": "#2d2d2d",
            "table_selected": "#3d3d3d",
            "placeholder_text": "#9ca3af"
        }
    }
    
    FONTS = {
        "title": ("Segoe UI", 24, "bold"),
        "subtitle": ("Segoe UI", 14),
        "indicator": ("Segoe UI", 22, "bold"),
        "subtext": ("Segoe UI", 12),
        "activity_title": ("Segoe UI", 13, "bold"),
        "activity_desc": ("Segoe UI", 12),
        "activity_time": ("Segoe UI", 11),
        # Polices spécifiques au gestionnaire de stock
        "label": ("Segoe UI", 12),
        "label_bold": ("Segoe UI", 12, "bold"),
        "button": ("Segoe UI", 13, "bold"),
        "button_active": ("Segoe UI", 13, "bold"),
        "table": ("Segoe UI", 11),
        "table_header": ("Segoe UI", 11, "bold"),
        "dialog_title": ("Segoe UI", 22, "bold")
    }
    
    SIZES = {
        "button_width": 120,
        "button_height": 36,
        "filter_button_width": 100,
        "filter_button_height": 32,
        "search_width": 250,
        "dialog_width": 500,
        "dialog_height": 450,
        "table_row_height": 45,
        "padding": 20,
        "small_padding": 10,
        "corner_radius": 10
    }
    
    def __init__(self, parent, **kwargs):
        super().__init__(parent, **kwargs)
        self.current_theme = "dark"  # Default to dark mode
        self.configure(fg_color=self.COLORS[self.current_theme]["bg"])
        self.grid_columnconfigure(0, weight=1)
        self.grid_rowconfigure(1, weight=1)
        
        # Données
        self.filter_type = "all"
        self.sort_column = "quantite"
        self.sort_ascending = False
        self.stock_data = []
        
        # Création de l'interface
        self._create_widgets()
        self._load_sample_data()
        print(f"DEBUG: StockManager initialized in {self.current_theme} mode")
